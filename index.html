<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StreamView</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #000000;
            --surface-color: rgba(25, 25, 25, 0.8);
            --accent-color: #2196F3;
            --accent-hover: #1976D2;
            --text-color: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        header {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 0.8rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        
        .logo i {
            color: var(--accent-color);
        }
        
        main {
            flex: 1;
            padding: 0;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .player-section {
            width: 100%;
            margin: 0 auto;
        }
        
        .player-container {
            width: 100%;
            position: relative;
            aspect-ratio: 16/9;
            background-color: #000;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* Para iOS y dispositivos táctiles donde el aspect-ratio puede fallar */
        @supports not (aspect-ratio: 16/9) {
            .player-container {
                height: 56.25vw; /* 9/16 * 100% */
            }
        }
        
        /* Escudo inicial */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.4s ease;
        }
        
        .welcome-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .welcome-screen h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
            padding: 0 1rem;
        }
        
        .welcome-screen p {
            font-size: 0.9rem;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--text-secondary);
            padding: 0 1.5rem;
            max-width: 500px;
        }
        
        .watch-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            -webkit-appearance: none;
        }
        
        .watch-btn:hover, .watch-btn:active {
            background-color: var(--accent-hover);
        }
        
        /* Iframe wrapper con protección */
        .stream-frame-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Inicialmente bloqueamos todos los clics */
            z-index: 1;
        }
        
        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Zonas interactivas seguras */
        .control-zones {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* No bloqueamos clics en general */
        }
        
        /* Zonas para controles específicos */
        .safe-zone {
            position: absolute;
            background-color: transparent;
            z-index: 5;
            pointer-events: auto; /* Esta zona permite clics */
        }
        
        /* Zona para botón de play/pause (generalmente parte inferior izquierda) */
        .play-zone {
            bottom: 0;
            left: 0;
            width: 15%;
            height: 20%;
        }
        
        /* Zona para control de volumen (generalmente parte inferior, a la derecha de play) */
        .volume-zone {
            bottom: 0;
            left: 15%;
            width: 15%;
            height: 20%;
        }
        
        /* Zona para fullscreen (generalmente esquina inferior derecha) */
        .fullscreen-zone {
            bottom: 0;
            right: 0;
            width: 15%;
            height: 20%;
        }
        
        /* Zona para otras áreas seguras del reproductor */
        .timeline-zone {
            bottom: 20%;
            left: 0;
            width: 100%;
            height: 10%;
        }
        
        /* Capa anti-anuncios para todo el reproductor */
        .ad-blocker-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: auto; /* Bloquea clics por defecto */
            background-color: transparent;
        }
        
        /* Badge de protección activa */
        .protection-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 15;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .protection-badge i {
            color: #f44336;
        }
        
        /* Fullscreen button propio (como respaldo) */
        .fullscreen-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 12;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .fullscreen-btn:hover, .fullscreen-btn:active {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        /* Notificación de bloqueo de anuncios */
        .popup-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }
        
        .popup-notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .popup-notification i {
            color: #f44336;
        }
        
        .popup-counter {
            background-color: #f44336;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        /* Información */
        .info-card {
            background-color: var(--surface-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 8px;
            margin: 1rem;
            padding: 1.2rem;
        }
        
        .info-card h2 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            font-weight: 500;
        }
        
        .info-card h2 i {
            color: var(--accent-color);
        }
        
        .info-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 0.8rem;
        }
        
        .tip-list {
            list-style: none;
        }
        
        .tip-list li {
            display: flex;
            padding: 0.5rem 0;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .tip-list li i {
            color: var(--accent-color);
            margin-top: 0.1rem;
            flex-shrink: 0;
        }
        
        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: auto;
        }
        
        /* Optimizaciones para iOS */
        @supports (-webkit-touch-callout: none) {
            .fullscreen-btn {
                width: 44px;
                height: 44px;
            }
            
            /* Evitar el zoom al tocar controles en iOS */
            input, button {
                font-size: 16px;
            }
        }
        
        /* Media queries para responsividad */
        @media (max-width: 480px) {
            .welcome-screen h2 {
                font-size: 1.2rem;
            }
            
            .welcome-screen p {
                font-size: 0.8rem;
            }
            
            .watch-btn {
                padding: 0.7rem 1.3rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-play-circle"></i>
            <span>StreamView</span>
        </div>
    </header>
    
    <main>
        <section class="player-section">
            <div class="player-container">
                <!-- Contenedor del iframe con protección -->
                <div class="stream-frame-container" id="streamContainer">
                    <iframe 
                        id="streamIframe"
                        src="about:blank" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        loading="lazy"
                        referrerpolicy="no-referrer"
                    ></iframe>
                </div>
                
                <!-- Capa anti-anuncios que cubre todo excepto las zonas seguras -->
                <div class="ad-blocker-overlay" id="adBlockerOverlay"></div>
                
                <!-- Zonas seguras que permiten interacción con controles específicos -->
                <div class="control-zones">
                    <div class="safe-zone play-zone" id="playZone"></div>
                    <div class="safe-zone volume-zone" id="volumeZone"></div>
                    <div class="safe-zone fullscreen-zone" id="fullscreenZone"></div>
                    <div class="safe-zone timeline-zone" id="timelineZone"></div>
                </div>
                
                <!-- Botón propio de pantalla completa como respaldo -->
                <button class="fullscreen-btn" id="fullscreenBtn">
                    <i class="fas fa-expand"></i>
                </button>
                
                <!-- Indicador de protección activa -->
                <div class="protection-badge">
                    <i class="fas fa-shield-alt"></i>
                    <span>Protección activa</span>
                </div>
                
                <!-- Pantalla de bienvenida inicial -->
                <div class="welcome-screen" id="welcomeScreen">
                    <h2>Stream protegido contra anuncios</h2>
                    <p>Hemos implementado una protección avanzada contra anuncios emergentes mientras disfrutas del contenido.</p>
                    <button class="watch-btn" id="watchButton">
                        <i class="fas fa-play"></i>
                        Ver Stream
                    </button>
                </div>
            </div>
            
            <div class="info-card">
                <h2><i class="fas fa-info-circle"></i> Información</h2>
                <p>Este stream está optimizado para dispositivos móviles y protegido contra anuncios.</p>
                <ul class="tip-list">
                    <li><i class="fas fa-check-circle"></i> <span>Usa los controles en la parte inferior del reproductor para ajustar volumen y reproducción.</span></li>
                    <li><i class="fas fa-check-circle"></i> <span>Si no puedes acceder a algún control, usa el botón de pantalla completa en la esquina inferior derecha.</span></li>
                    <li><i class="fas fa-check-circle"></i> <span>Si experimentas problemas, intenta actualizar la página.</span></li>
                </ul>
            </div>
        </section>
    </main>
    
    <footer>
        <p>&copy; 2025 StreamView | Una experiencia de visualización premium</p>
    </footer>
    
    <!-- Notificación de bloqueo de popups -->
    <div class="popup-notification" id="popupNotification">
        <i class="fas fa-ban"></i>
        <span>Anuncios bloqueados</span>
        <div class="popup-counter" id="popupCounter">0</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Referencias a elementos del DOM
            const streamIframe = document.getElementById('streamIframe');
            const streamContainer = document.getElementById('streamContainer');
            const welcomeScreen = document.getElementById('welcomeScreen');
            const watchButton = document.getElementById('watchButton');
            const adBlockerOverlay = document.getElementById('adBlockerOverlay');
            const playZone = document.getElementById('playZone');
            const volumeZone = document.getElementById('volumeZone');
            const fullscreenZone = document.getElementById('fullscreenZone');
            const timelineZone = document.getElementById('timelineZone');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const popupNotification = document.getElementById('popupNotification');
            const popupCounter = document.getElementById('popupCounter');
            
            // Variables de estado
            let blockCount = 0;
            let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            let isAndroid = /Android/.test(navigator.userAgent);
            let isMobile = isIOS || isAndroid || window.innerWidth <= 768;
            let originalWindowOpen = window.open;
            let originalCreateElement = document.createElement;
            let safeMode = true; // Modo agresivo de bloqueo
            let lastSafeClick = 0;
            
            // Función para cargar el stream con protección
            function loadStreamSafely() {
                // Cargamos el iframe después para mayor control
                streamIframe.src = "https://sons-stream.com/tvon.php?hd=112";
                
                // Implementamos protección contra anuncios
                setupAdvancedAdBlocking();
                
                // Configuramos las zonas seguras
                setupSafeZones();
                
                // Mostramos el iframe
                streamContainer.style.pointerEvents = "none";
                
                // Añadimos nuestros propios controles
                setupCustomControls();
            }
            
            // Iniciar la visualización al hacer clic en el botón
            watchButton.addEventListener('click', function() {
                welcomeScreen.classList.add('hidden');
                
                // Cargamos el stream de forma segura después de un breve retraso
                setTimeout(loadStreamSafely, 300);
            });
            
            // Configurar zonas seguras que permiten interactuar con el reproductor
            function setupSafeZones() {
                // Las zonas seguras permiten que los clics pasen al iframe subyacente
                // pero solo en áreas específicas donde están los controles del reproductor
                
                // Función para manejar clics en zonas seguras
                const handleSafeZoneClick = function(zone, e) {
                    // Temporalmente permitir que el clic pase al iframe
                    streamContainer.style.pointerEvents = "auto";
                    
                    // Registramos este clic como seguro
                    lastSafeClick = Date.now();
                    
                    // Desactivamos temporalmente el bloqueador de popup para este clic legítimo
                    safeMode = false;
                    
                    // Reactivamos después de un breve período
                    setTimeout(function() {
                        streamContainer.style.pointerEvents = "none";
                        safeMode = true;
                    }, 300); // Tiempo suficiente para que el clic se registre pero no para que se abran popups
                };
                
                // Asignar manejadores de eventos a cada zona segura
                playZone.addEventListener('click', function(e) {
                    handleSafeZoneClick('play', e);
                    
                    // No propagamos el evento para evitar que active el overlay
                    e.stopPropagation();
                });
                
                volumeZone.addEventListener('click', function(e) {
                    handleSafeZoneClick('volume', e);
                    e.stopPropagation();
                });
                
                fullscreenZone.addEventListener('click', function(e) {
                    handleSafeZoneClick('fullscreen', e);
                    e.stopPropagation();
                });
                
                timelineZone.addEventListener('click', function(e) {
                    handleSafeZoneClick('timeline', e);
                    e.stopPropagation();
                });
                
                // El overlay general bloquea los clics en el resto del reproductor
                adBlockerOverlay.addEventListener('click', function(e) {
                    // Si es un clic fuera de las zonas seguras, lo bloqueamos
                    e.stopPropagation();
                    
                    // Mostramos notificación para que el usuario sepa que se bloqueó un posible anuncio
                    incrementBlockCount("Clic bloqueado en área insegura");
                });
            }
            
            // Configurar controles personalizados
            function setupCustomControls() {
                // Botón de pantalla completa personalizado
                fullscreenBtn.addEventListener('click', function() {
                    toggleFullscreen();
                });
            }
            
            // Sistema avanzado de bloqueo de anuncios
            function setupAdvancedAdBlocking() {
                // 1. Reemplazar window.open para evitar popups
                window.open = function(url, target, features) {
                    // Bloqueamos solo en modo seguro
                    if (safeMode) {
                        incrementBlockCount("Ventana emergente bloqueada");
                        return null;
                    } else {
                        // Si estamos en modo seguro (clic en zona controlada), permitimos la acción original
                        // pero solo para algunos casos específicos (por ejemplo fullscreen)
                        if (target === "_self" || (features && features.includes("fullscreen"))) {
                            return originalWindowOpen.call(window, url, target, features);
                        }
                        // Para otros casos, seguimos bloqueando
                        incrementBlockCount("Ventana emergente sospechosa bloqueada");
                        return null;
                    }
                };
                
                // 2. Modificar document.createElement para detectar iframes maliciosos
                document.createElement = function(tagName) {
                    const element = originalCreateElement.call(document, tagName);
                    
                    // Si se está creando un iframe, lo monitoreamos
                    if (tagName.toLowerCase() === 'iframe') {
                        // Establecemos un MutationObserver para detectar cambios sospechosos
                        setTimeout(function() {
                            // Si no es nuestro iframe principal y está cargando contenido externo sospechoso
                            if (element !== streamIframe && element.src && 
                                !element.src.includes('sons-stream.com')) {
                                
                                incrementBlockCount("Iframe externo bloqueado");
                                element.src = "about:blank"; // Limpiar
                                
                                // Si tiene padre, intentar quitar del DOM
                                if (element.parentNode) {
                                    element.parentNode.removeChild(element);
                                }
                            }
                        }, 0);
                    }
                    
                    return element;
                };
                
                // 3. Interceptar eventos de redirect
                let lastBeforeUnloadTime = 0;
                
                window.addEventListener('beforeunload', function(e) {
                    const now = Date.now();
                    
                    // Si ocurre poco después de un clic seguro, permitimos el evento
                    if (now - lastSafeClick < 1000) {
                        return;
                    }
                    
                    // Si ocurre muy cerca de otro evento beforeunload, es sospechoso
                    if (now - lastBeforeUnloadTime < 100) {
                        e.preventDefault();
                        e.returnValue = '';
                        incrementBlockCount("Redirección múltiple bloqueada");
                        return false;
                    }
                    
                    lastBeforeUnloadTime = now;
                });
                
                // 4. Bloquear la apertura de ventanas por scripts sin interacción del usuario
                Object.defineProperty(window, 'open', {
                    configurable: false,
                    writable: false,
                    value: window.open
                });
                
                // 5. Monitorear cambios en el DOM para detectar elementos maliciosos
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                            for (let i = 0; i < mutation.addedNodes.length; i++) {
                                const node = mutation.addedNodes[i];
                                
                                // Detectar iframes maliciosos
                                if (node.nodeName === 'IFRAME' && node !== streamIframe) {
                                    // Solo bloqueamos si no está en una zona segura
                                    const isInSafeContainer = false; // Lógica para determinar si es parte legítima del reproductor
                                    
                                    if (!isInSafeContainer) {
                                        incrementBlockCount("Iframe malicioso bloqueado");
                                        node.src = "about:blank";
                                        if (node.parentNode) {
                                            node.parentNode.removeChild(node);
                                        }
                                    }
                                }
                                
                                // Detectar enlaces maliciosos
                                if (node.nodeName === 'A') {
                                    // Asegurarnos que los enlaces externos sean seguros
                                    node.setAttribute('rel', 'noopener noreferrer');
                                    
                                    // Si abre en una nueva ventana, podría ser un anuncio
                                    if (node.getAttribute('target') === '_blank') {
                                        node.addEventListener('click', function(e) {
                                            // Verificamos si es un clic legítimo en una zona segura
                                            if (safeMode) {
                                                e.preventDefault();
                                                incrementBlockCount("Enlace externo bloqueado");
                                            }
                                        });
                                    }
                                }
                            }
                        }
                    });
                });
                
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
                
                // 6. Manejar timers sospechosos (muchos sitios de anuncios usan setTimeout)
                const originalSetTimeout = window.setTimeout;
                window.setTimeout = function(callback, delay) {
                    // Si el retraso es muy corto y estamos en modo seguro, podría ser un popup
                    if (safeMode && delay < 50 && typeof callback === 'function') {
                        // Envolvemos la función para monitorizarla
                        const wrappedCallback = function() {
                            try {
                                // Intentamos detectar si la función intenta abrir ventanas
                                const callbackString = callback.toString();
                                if (callbackString.includes('window.open') || 
                                    callbackString.includes('location.href') ||
                                    callbackString.includes('document.location')) {
                                    
                                    incrementBlockCount("Script sospechoso bloqueado");
                                    return;
                                }
                                
                                return callback.apply(this, arguments);
                            } catch (e) {
                                console.error('Error en callback:', e);
                            }
                        };
                        
                        return originalSetTimeout.call(window, wrappedCallback, delay);
                    }
                    
                    return originalSetTimeout.apply(window, arguments);
                };
            }
            
            // Incrementar contador de bloqueos y mostrar notificación
            function incrementBlockCount(reason) {
                blockCount++;
                popupCounter.textContent = blockCount;
                
                // Mostrar notificación
                popupNotification.classList.add('show');
                
                // Log para debug
                console.log(`Bloqueo #${blockCount}: ${reason}`);
                
                // Ocultar después de 3 segundos
                setTimeout(function() {
                    popupNotification.classList.remove('show');
                }, 3000);
            }
            
            // Toggle pantalla completa
            function toggleFullscreen() {
                const container = document.querySelector('.player-container');
                
                if (!document.fullscreenElement && 
                    !document.mozFullScreenElement && 
                    !document.webkitFullscreenElement && 
                    !document.msFullscreenElement) {
                    
                    // Entrar en pantalla completa
                    if (container.requestFullscreen) {
                        container.requestFullscreen();
                    } else if (container.mozRequestFullScreen) {
                        container.mozRequestFullScreen();
                    } else if (container.webkitRequestFullscreen) {
                        container.webkitRequestFullscreen();
                    } else if (container.msRequestFullscreen) {
                        container.msRequestFullscreen();
                    }
                    
                    // Cambiar icono
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                    
                } else {
                    // Salir de pantalla completa
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    
                    // Cambiar icono
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                }
            }
            
            // Ajustes basados en si estamos en pantalla completa
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
            
            function handleFullscreenChange() {
                const isFullscreen = !!document.fullscreenElement || 
                                   !!document.webkitFullscreenElement || 
                                   !!document.mozFullScreenElement || 
                                   !!document.msFullscreenElement;
                
                if (isFullscreen) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                } else {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                }
            }
        });
    </script>
</body>
</html>
